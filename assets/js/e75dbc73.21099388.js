"use strict";(self.webpackChunkfiber_docs=self.webpackChunkfiber_docs||[]).push([[64974],{3905:(e,t,a)=>{a.d(t,{Zo:()=>s,kt:()=>c});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var d=r.createContext({}),p=function(e){var t=r.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},s=function(e){var t=p(e.components);return r.createElement(d.Provider,{value:t},e.children)},m="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,d=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),m=p(a),k=n,c=m["".concat(d,".").concat(k)]||m[k]||f[k]||i;return a?r.createElement(c,o(o({ref:t},s),{},{components:a})):r.createElement(c,o({ref:t},s))}));function c(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=k;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l[m]="string"==typeof e?e:n,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}k.displayName="MDXCreateElement"},65513:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>f,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=a(87462),n=(a(67294),a(3905));const i={id:"csrf"},o="CSRF",l={unversionedId:"api/middleware/csrf",id:"api/middleware/csrf",title:"CSRF",description:'CSRF middleware for Fiber that provides Cross-site request forgery protection by passing a csrf token via cookies. This cookie value will be used to compare against the client csrf token on requests, other than those defined as "safe" by RFC7231 \\(GET, HEAD, OPTIONS, or TRACE\\). When the csrf token is invalid, this middleware will return the fiber.ErrForbidden error.',source:"@site/docs/core/api/middleware/csrf.md",sourceDirName:"api/middleware",slug:"/api/middleware/csrf",permalink:"/next/api/middleware/csrf",draft:!1,editUrl:"https://github.com/gofiber/fiber/edit/master/docs/api/middleware/csrf.md",tags:[],version:"current",lastUpdatedAt:1691074140,formattedLastUpdatedAt:"Aug 3, 2023",frontMatter:{id:"csrf"},sidebar:"tutorialSidebar",previous:{title:"CORS",permalink:"/next/api/middleware/cors"},next:{title:"EarlyData",permalink:"/next/api/middleware/earlydata"}},d={},p=[{value:"Signatures",id:"signatures",level:2},{value:"Examples",id:"examples",level:2},{value:"Config",id:"config",level:2},{value:"Config",id:"config-1",level:3},{value:"Default Config",id:"default-config",level:2},{value:"Constants",id:"constants",level:2},{value:"Custom Storage/Database",id:"custom-storagedatabase",level:3}],s={toc:p},m="wrapper";function f(e){let{components:t,...a}=e;return(0,n.kt)(m,(0,r.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"csrf"},"CSRF"),(0,n.kt)("p",null,"CSRF middleware for ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gofiber/fiber"},"Fiber")," that provides ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Cross-site_request_forgery"},"Cross-site request forgery"),' protection by passing a csrf token via cookies. This cookie value will be used to compare against the client csrf token on requests, other than those defined as "safe" by RFC7231 ',"(","GET, HEAD, OPTIONS, or TRACE",")",". When the csrf token is invalid, this middleware will return the ",(0,n.kt)("inlineCode",{parentName:"p"},"fiber.ErrForbidden")," error. "),(0,n.kt)("p",null,"CSRF Tokens are generated on GET requests. You can retrieve the CSRF token with ",(0,n.kt)("inlineCode",{parentName:"p"},"c.Locals(contextKey)"),", where ",(0,n.kt)("inlineCode",{parentName:"p"},"contextKey")," is the string you set in the config (see Custom Config below)."),(0,n.kt)("p",null,"When no ",(0,n.kt)("inlineCode",{parentName:"p"},"csrf_")," cookie is set, or the token has expired, a new token will be generated and ",(0,n.kt)("inlineCode",{parentName:"p"},"csrf_")," cookie set."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"This middleware uses our ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gofiber/storage"},"Storage")," package to support various databases through a single interface. The default configuration for this middleware saves data to memory, see the examples below for other databases.")),(0,n.kt)("h2",{id:"signatures"},"Signatures"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},"func New(config ...Config) fiber.Handler\n")),(0,n.kt)("h2",{id:"examples"},"Examples"),(0,n.kt)("p",null,"Import the middleware package that is part of the Fiber web framework"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    "github.com/gofiber/fiber/v2"\n    "github.com/gofiber/fiber/v2/middleware/csrf"\n)\n')),(0,n.kt)("p",null,"After you initiate your Fiber app, you can use the following possibilities:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'// Initialize default config\napp.Use(csrf.New())\n\n// Or extend your config for customization\napp.Use(csrf.New(csrf.Config{\n    KeyLookup:      "header:X-Csrf-Token",\n    CookieName:     "csrf_",\n    CookieSameSite: "Lax",\n    Expiration:     1 * time.Hour,\n    KeyGenerator:   utils.UUID,\n    Extractor:      func(c *fiber.Ctx) (string, error) { ... },\n}))\n')),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"KeyLookup will be ignored if Extractor is explicitly set.")),(0,n.kt)("h2",{id:"config"},"Config"),(0,n.kt)("h3",{id:"config-1"},"Config"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Property"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Default"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Next"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"func(*fiber.Ctx) bool")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Next defines a function to skip this middleware when returned true."),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"nil"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"KeyLookup"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"string")),(0,n.kt)("td",{parentName:"tr",align:"left"},'KeyLookup is a string in the form of "',(0,n.kt)("inlineCode",{parentName:"td"},"<source>:<key>"),'" that is used to create an Extractor that extracts the token from the request. Possible values: "',(0,n.kt)("inlineCode",{parentName:"td"},"header:<name>"),'", "',(0,n.kt)("inlineCode",{parentName:"td"},"query:<name>"),'", "',(0,n.kt)("inlineCode",{parentName:"td"},"param:<name>"),'", "',(0,n.kt)("inlineCode",{parentName:"td"},"form:<name>"),'", "',(0,n.kt)("inlineCode",{parentName:"td"},"cookie:<name>"),'". Ignored if an Extractor is explicitly set.'),(0,n.kt)("td",{parentName:"tr",align:"left"},'"header:X-CSRF-Token"')),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookieName"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"string")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Name of the session cookie. This cookie will store the session key."),(0,n.kt)("td",{parentName:"tr",align:"left"},'"csrf_"')),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookieDomain"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"string")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Domain of the CSRF cookie."),(0,n.kt)("td",{parentName:"tr",align:"left"},'""')),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookiePath"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"string")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Path of the CSRF cookie."),(0,n.kt)("td",{parentName:"tr",align:"left"},'""')),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookieSecure"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"bool")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Indicates if the CSRF cookie is secure."),(0,n.kt)("td",{parentName:"tr",align:"left"},"false")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookieHTTPOnly"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"bool")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Indicates if the CSRF cookie is HTTP-only."),(0,n.kt)("td",{parentName:"tr",align:"left"},"false")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookieSameSite"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"string")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Value of SameSite cookie."),(0,n.kt)("td",{parentName:"tr",align:"left"},'"Lax"')),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookieSessionOnly"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"bool")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Decides whether the cookie should last for only the browser session. Ignores Expiration if set to true."),(0,n.kt)("td",{parentName:"tr",align:"left"},"false")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Expiration"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"time.Duration")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Expiration is the duration before the CSRF token will expire."),(0,n.kt)("td",{parentName:"tr",align:"left"},"1 * time.Hour")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Storage"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"fiber.Storage")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Store is used to store the state of the middleware."),(0,n.kt)("td",{parentName:"tr",align:"left"},"memory.New()")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"ContextKey"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"string")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Context key to store the generated CSRF token into the context. If left empty, the token will not be stored in the context."),(0,n.kt)("td",{parentName:"tr",align:"left"},'""')),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"KeyGenerator"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"func() string")),(0,n.kt)("td",{parentName:"tr",align:"left"},"KeyGenerator creates a new CSRF token."),(0,n.kt)("td",{parentName:"tr",align:"left"},"utils.UUID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"CookieExpires"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"time.Duration")," (Deprecated)"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Deprecated: Please use Expiration."),(0,n.kt)("td",{parentName:"tr",align:"left"},"0")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Cookie"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"*fiber.Cookie")," (Deprecated)"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Deprecated: Please use Cookie* related fields."),(0,n.kt)("td",{parentName:"tr",align:"left"},"nil")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"TokenLookup"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"string")," (Deprecated)"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Deprecated: Please use KeyLookup."),(0,n.kt)("td",{parentName:"tr",align:"left"},'""')),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"ErrorHandler"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"fiber.ErrorHandler")),(0,n.kt)("td",{parentName:"tr",align:"left"},"ErrorHandler is executed when an error is returned from fiber.Handler."),(0,n.kt)("td",{parentName:"tr",align:"left"},"DefaultErrorHandler")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Extractor"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"func(*fiber.Ctx) (string, error)")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Extractor returns the CSRF token. If set, this will be used in place of an Extractor based on KeyLookup."),(0,n.kt)("td",{parentName:"tr",align:"left"},"Extractor based on KeyLookup")))),(0,n.kt)("h2",{id:"default-config"},"Default Config"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'var ConfigDefault = Config{\n    KeyLookup:      "header:" + HeaderName,\n    CookieName:     "csrf_",\n    CookieSameSite: "Lax",\n    Expiration:     1 * time.Hour,\n    KeyGenerator:   utils.UUID,\n    ErrorHandler:   defaultErrorHandler,\n    Extractor:      CsrfFromHeader(HeaderName),\n}\n')),(0,n.kt)("h2",{id:"constants"},"Constants"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'const (\n    HeaderName = "X-Csrf-Token"\n)\n')),(0,n.kt)("h3",{id:"custom-storagedatabase"},"Custom Storage/Database"),(0,n.kt)("p",null,"You can use any storage from our ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gofiber/storage/"},"storage")," package."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},"storage := sqlite3.New() // From github.com/gofiber/storage/sqlite3\napp.Use(csrf.New(csrf.Config{\n    Storage: storage,\n}))\n")))}f.isMDXComponent=!0}}]);